# MCP Debug Tools - Thread Debugging Sample

Node.js Worker Threadsë¥¼ ì‚¬ìš©í•œ ë©€í‹° ìŠ¤ë ˆë“œ ë””ë²„ê¹… ì˜ˆì œì…ë‹ˆë‹¤. ë©”ëª¨ë¦¬ êµ¬ì¡°ì™€ ìŠ¤ë ˆë“œ ê°„ í†µì‹ ì„ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“‹ ì˜ˆì œ ë‚´ìš©

ì´ ìƒ˜í”Œì€ ë‹¤ìŒê³¼ ê°™ì€ ë©€í‹° ìŠ¤ë ˆë“œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

### 1. **CPU ì§‘ì•½ì  ê³„ì‚° (ì†Œìˆ˜ ì°¾ê¸°)**
- ì—¬ëŸ¬ ì›Œì»¤ ìŠ¤ë ˆë“œì—ì„œ ë™ì‹œ ê³„ì‚°
- ì›Œì»¤ í’€ íŒ¨í„´ êµ¬í˜„
- ë³‘ë ¬ ì²˜ë¦¬ ì„±ëŠ¥ ë¹„êµ

### 2. **ë³‘ë ¬ ë°ì´í„° ì •ë ¬**
- ëŒ€ìš©ëŸ‰ ë°°ì—´ì„ ì²­í¬ë¡œ ë¶„í• 
- ê° ì›Œì»¤ì—ì„œ ë…ë¦½ì  ì •ë ¬
- ì •ë ¬ëœ ê²°ê³¼ ë³‘í•©

### 3. **SharedArrayBuffer ë©”ëª¨ë¦¬ ê³µìœ **
- ìŠ¤ë ˆë“œ ê°„ ë©”ëª¨ë¦¬ ê³µìœ 
- Atomicsë¥¼ ì‚¬ìš©í•œ ì•ˆì „í•œ ë©”ëª¨ë¦¬ ì ‘ê·¼
- ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„

### 4. **ì›Œì»¤ ê°„ ì§ì ‘ í†µì‹ **
- MessageChannelì„ í†µí•œ í†µì‹ 
- ì›Œì»¤ ê°„ ë°ì´í„° ì „ë‹¬
- ë³‘ë ¬ ê²€ìƒ‰ ì‘ì—…

### 5. **ì„±ëŠ¥ ì¸¡ì • ë° ë¹„êµ**
- ë‹¨ì¼ ìŠ¤ë ˆë“œ vs ë©€í‹° ìŠ¤ë ˆë“œ
- ì‹¤í–‰ ì‹œê°„ ì¸¡ì •
- ì„±ëŠ¥ í–¥ìƒ ê³„ì‚°

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ì¼ë°˜ ì‹¤í–‰
```bash
npm start
# ë˜ëŠ”
node worker-threads.js
```

### ë””ë²„ê·¸ ëª¨ë“œ ì‹¤í–‰
```bash
npm run debug
# ë˜ëŠ”
node --inspect worker-threads.js

# ëª¨ë“  ì›Œì»¤ ë””ë²„ê·¸
npm run debug-workers
```

### SharedArrayBuffer í™œì„±í™”
```bash
node --no-warnings --experimental-worker worker-threads.js
```

### VSCodeì—ì„œ ë””ë²„ê¹…

1. VSCodeì—ì„œ ì´ í´ë”ë¥¼ ì—½ë‹ˆë‹¤
2. ì¢Œì¸¡ ë””ë²„ê·¸ íƒ­ í´ë¦­ (Ctrl+Shift+D)
3. ìƒë‹¨ ë“œë¡­ë‹¤ìš´ì—ì„œ ë””ë²„ê·¸ êµ¬ì„± ì„ íƒ:
   - **Debug Main Thread Only**: ë©”ì¸ ìŠ¤ë ˆë“œë§Œ ë””ë²„ê¹…
   - **Debug with Worker Threads**: ì›Œì»¤ ìŠ¤ë ˆë“œ í¬í•¨ ë””ë²„ê¹…
   - **Debug with SharedArrayBuffer**: SharedArrayBuffer í™œì„±í™”
   - **Attach to Worker Process**: ì‹¤í–‰ ì¤‘ì¸ ì›Œì»¤ì— ì—°ê²°
4. F5 ë˜ëŠ” ì‹¤í–‰ ë²„íŠ¼ í´ë¦­

## ğŸ” MCP Debug Tools ì‚¬ìš© ì˜ˆì œ

### 1. ì›Œì»¤ ìŠ¤ë ˆë“œ ì¶”ì 

```javascript
// AIì—ê²Œ ìš”ì²­ ì˜ˆì‹œ:
"ëª¨ë“  í™œì„± ì›Œì»¤ ìŠ¤ë ˆë“œë¥¼ ë³´ì—¬ì¤˜"
"threadIdê°€ 2ì¸ ì›Œì»¤ì˜ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•´ì¤˜"
```

### 2. ë©”ëª¨ë¦¬ ê³µìœ  ë””ë²„ê¹…

```javascript
// AIì—ê²Œ ìš”ì²­ ì˜ˆì‹œ:
"SharedArrayBufferì˜ ë©”ëª¨ë¦¬ ë‚´ìš©ì„ ë³´ì—¬ì¤˜"
"Atomics ì—°ì‚°ì´ ì¼ì–´ë‚˜ëŠ” ë¶€ë¶„ì— ë¸Œë ˆì´í¬í¬ì¸íŠ¸ë¥¼ ì„¤ì •í•´ì¤˜"
```

### 3. ë©”ì‹œì§€ í†µì‹  ì¶”ì 

```javascript
// AIì—ê²Œ ìš”ì²­ ì˜ˆì‹œ:
"ì›Œì»¤ë¡œ ì „ë‹¬ë˜ëŠ” ë©”ì‹œì§€ë¥¼ ì¶”ì í•´ì¤˜"
"parentPortì˜ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ì— ë¸Œë ˆì´í¬í¬ì¸íŠ¸ë¥¼ ì„¤ì •í•´ì¤˜"
```

### 4. ì„±ëŠ¥ ë¶„ì„

```javascript
// AIì—ê²Œ ìš”ì²­ ì˜ˆì‹œ:
"ê° ì›Œì»¤ì˜ ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•´ì¤˜"
"ë³‘ë ¬ ì²˜ë¦¬ì™€ ìˆœì°¨ ì²˜ë¦¬ì˜ ì„±ëŠ¥ì„ ë¹„êµí•´ì¤˜"
```

## ğŸ“Š ì£¼ìš” ë””ë²„ê¹… í¬ì¸íŠ¸

### ì¶”ì²œ ë¸Œë ˆì´í¬í¬ì¸íŠ¸ ìœ„ì¹˜

#### ë©”ì¸ ìŠ¤ë ˆë“œ
1. **ë¼ì¸ 226**: WorkerPool í´ë˜ìŠ¤ - ì›Œì»¤ ìƒì„± ë¡œì§
2. **ë¼ì¸ 285**: ë³‘ë ¬ ì‘ì—… ì‹œì‘ - íƒœìŠ¤í¬ ë¶„ë°°
3. **ë¼ì¸ 344**: SharedArrayBuffer ìƒì„± - ë©”ëª¨ë¦¬ í• ë‹¹
4. **ë¼ì¸ 516**: ì„±ëŠ¥ ì¸¡ì • - ì‹œê°„ ë¹„êµ

#### ì›Œì»¤ ìŠ¤ë ˆë“œ
1. **ë¼ì¸ 32**: workerTask í•¨ìˆ˜ - ì‘ì—… ë¶„ê¸°ì 
2. **ë¼ì¸ 82**: CPU ì§‘ì•½ì  ê³„ì‚° - ì†Œìˆ˜ ì°¾ê¸° ì•Œê³ ë¦¬ì¦˜
3. **ë¼ì¸ 153**: SharedArrayBuffer ì¡°ì‘ - ë©”ëª¨ë¦¬ ì“°ê¸°
4. **ë¼ì¸ 178**: ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ - í†µì‹  ì²˜ë¦¬

### ë³€ìˆ˜ ê´€ì°° ëª©ë¡

ë””ë²„ê¹… ì‹œ ë‹¤ìŒ ë³€ìˆ˜ë“¤ì„ Watchì— ì¶”ê°€í•˜ë©´ ìœ ìš©í•©ë‹ˆë‹¤:

#### ë©”ì¸ ìŠ¤ë ˆë“œ
- `pool.workers`: ì›Œì»¤ í’€ì˜ ì›Œì»¤ ëª©ë¡
- `pool.activeWorkers`: í™œì„± ì›Œì»¤ ìˆ˜
- `sharedArray`: ê³µìœ  ë©”ëª¨ë¦¬ ë°°ì—´
- `results`: ì›Œì»¤ ê²°ê³¼ ìˆ˜ì§‘

#### ì›Œì»¤ ìŠ¤ë ˆë“œ
- `threadId`: í˜„ì¬ ìŠ¤ë ˆë“œ ID
- `workerData`: ì›Œì»¤ë¡œ ì „ë‹¬ëœ ë°ì´í„°
- `parentPort`: ë©”ì¸ ìŠ¤ë ˆë“œì™€ì˜ í†µì‹  í¬íŠ¸
- `sharedBuffer`: ê³µìœ  ë©”ëª¨ë¦¬ ë²„í¼

## ğŸ¯ í•™ìŠµ ëª©í‘œ

ì´ ì˜ˆì œë¥¼ í†µí•´ ë‹¤ìŒì„ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

### 1. **ë©€í‹° ìŠ¤ë ˆë“œ í”„ë¡œê·¸ë˜ë°**
- Worker Threads API ì´í•´
- ìŠ¤ë ˆë“œ ìƒì„±ê³¼ ì¢…ë£Œ
- ìŠ¤ë ˆë“œ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬

### 2. **ìŠ¤ë ˆë“œ ê°„ í†µì‹ **
- ë©”ì‹œì§€ ê¸°ë°˜ í†µì‹ 
- MessageChannel í™œìš©
- ë°ì´í„° ì§ë ¬í™”ì™€ ì—­ì§ë ¬í™”

### 3. **ë©”ëª¨ë¦¬ ê³µìœ **
- SharedArrayBuffer ì‚¬ìš©ë²•
- Atomics ì—°ì‚° ì´í•´
- ë™ê¸°í™”ì™€ ê²½ìŸ ìƒíƒœ ë°©ì§€

### 4. **ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”**
- ì›Œì»¤ í’€ íŒ¨í„´
- ì‘ì—… ë¶„ë°° ì „ëµ
- ì„±ëŠ¥ ì¸¡ì •ê³¼ ë¶„ì„

## ğŸ’¡ ê³ ê¸‰ ë””ë²„ê¹… ê¸°ë²•

### 1. ì›Œì»¤ë³„ ë””ë²„ê¹…

```javascript
// íŠ¹ì • ì›Œì»¤ë§Œ ë””ë²„ê¹…í•˜ê¸°
if (threadId === 2) {
    debugger; // ì´ ì›Œì»¤ë§Œ ì¤‘ë‹¨
}
```

### 2. ì¡°ê±´ë¶€ ë¡œê¹…

```javascript
// íŠ¹ì • ì¡°ê±´ì—ì„œë§Œ ë¡œê·¸ ì¶œë ¥
if (workerData.taskType === 'compute' && result.count > 100) {
    console.log('Large prime count:', result);
}
```

### 3. ë©”ëª¨ë¦¬ ë¤í”„

```javascript
// SharedArrayBuffer ìƒíƒœ ë¤í”„
console.log('Memory snapshot:', Array.from(sharedArray.slice(0, 20)));
```

### 4. íƒ€ì´ë° ë¶„ì„

```javascript
// ê° ë‹¨ê³„ë³„ ì‹œê°„ ì¸¡ì •
const stepStart = performance.now();
// ... ì‘ì—… ìˆ˜í–‰ ...
const stepTime = performance.now() - stepStart;
console.log(`Step completed in ${stepTime}ms`);
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### SharedArrayBuffer ê´€ë ¨
- ì¼ë¶€ í™˜ê²½ì—ì„œëŠ” ë³´ì•ˆìƒ ë¹„í™œì„±í™”ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ
- í•„ìš”ì‹œ `--no-warnings --experimental-worker` í”Œë˜ê·¸ ì‚¬ìš©
- COOP/COEP í—¤ë”ê°€ í•„ìš”í•  ìˆ˜ ìˆìŒ

### ì›Œì»¤ ë””ë²„ê¹…
- ì›Œì»¤ëŠ” ë³„ë„ì˜ V8 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ë¨
- ê° ì›Œì»¤ëŠ” ë…ë¦½ì ì¸ ë©”ëª¨ë¦¬ ê³µê°„ ì‚¬ìš©
- ë””ë²„ê±° ì—°ê²° ì‹œ í¬íŠ¸ ì¶©ëŒ ì£¼ì˜

### ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­
- ì›Œì»¤ ìƒì„±ì€ ë¹„ìš©ì´ ë†’ìŒ (ì›Œì»¤ í’€ ì‚¬ìš© ê¶Œì¥)
- ì‘ì€ ì‘ì—…ì€ ì˜¤íˆë ¤ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥
- ë©”ì‹œì§€ ì „ë‹¬ ì‹œ ë°ì´í„° ë³µì‚¬ ë¹„ìš© ê³ ë ¤

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [MCP Debug Tools ë©”ì¸ ë¬¸ì„œ](../../README.md)
- [Node.js Worker Threads ë¬¸ì„œ](https://nodejs.org/api/worker_threads.html)
- [SharedArrayBuffer MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer)
- [Atomics MDN](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Atomics)

## ğŸ› ë¬¸ì œ í•´ê²°

### ì›Œì»¤ê°€ ì‹œì‘ë˜ì§€ ì•ŠëŠ” ê²½ìš°
1. Node.js ë²„ì „ í™•ì¸ (14.0.0 ì´ìƒ í•„ìš”)
2. Worker Threads ì§€ì› ì—¬ë¶€ í™•ì¸
3. íŒŒì¼ ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

### SharedArrayBufferê°€ undefinedì¸ ê²½ìš°
1. Node.js í”Œë˜ê·¸ í™•ì¸: `--no-warnings --experimental-worker`
2. ë¸Œë¼ìš°ì € í™˜ê²½ì´ ì•„ë‹Œ Node.js í™˜ê²½ì¸ì§€ í™•ì¸
3. Node.js ë²„ì „ ì—…ë°ì´íŠ¸ ê³ ë ¤

### ë””ë²„ê±°ê°€ ì›Œì»¤ì— ì—°ê²°ë˜ì§€ ì•ŠëŠ” ê²½ìš°
1. `autoAttachChildProcesses: true` ì„¤ì • í™•ì¸
2. í¬íŠ¸ ì¶©ëŒ í™•ì¸ (ê¸°ë³¸: 9229)
3. VSCode ë””ë²„ê±° ì¬ì‹œì‘

## ğŸ“ˆ í™•ì¥ ì•„ì´ë””ì–´

1. **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€**: ê° ì›Œì»¤ê°€ ë…ë¦½ì ì¸ DB ì—°ê²° ê´€ë¦¬
2. **ì´ë¯¸ì§€ ì²˜ë¦¬**: ì´ë¯¸ì§€ë¥¼ íƒ€ì¼ë¡œ ë¶„í• í•˜ì—¬ ë³‘ë ¬ ì²˜ë¦¬
3. **ì›¹ ì„œë²„**: ê° ì›Œì»¤ê°€ ë…ë¦½ì ì¸ HTTP ìš”ì²­ ì²˜ë¦¬
4. **ë¨¸ì‹ ëŸ¬ë‹**: ë°ì´í„°ì…‹ì„ ë¶„í• í•˜ì—¬ ë³‘ë ¬ í•™ìŠµ
5. **íŒŒì¼ ì²˜ë¦¬**: ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì²­í¬ë¡œ ë‚˜ëˆ„ì–´ ë³‘ë ¬ ë¶„ì„

---

**Happy Multi-threaded Debugging! ğŸš€ğŸ”§**